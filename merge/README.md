# Minishell Fork and Execute ìˆ˜ì • ë³´ê³ ì„œ

## ğŸ“‹ ê°œìš”
ì´ ë¬¸ì„œëŠ” minishell í”„ë¡œì íŠ¸ì˜ `fork_and_execute` í•¨ìˆ˜ ë° ê´€ë ¨ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ë¡œì§ì—ì„œ ë°œìƒí•œ ë¬¸ì œë“¤ì„ ì§„ë‹¨í•˜ê³  ìˆ˜ì •í•œ ê³¼ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤.

## ğŸ› ë°œê²¬ëœ ë¬¸ì œì ë“¤

### 1. íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì‹œ ë¬´í•œ ë£¨í”„/ë¸”ë¡œí‚¹
- **ì¦ìƒ**: ì™¸ë¶€ ëª…ë ¹ì–´ (`ls`, `grep` ë“±)ì™€ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì‹œ ì‘ë‹µ ì—†ìŒ
- **ì›ì¸**: ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ë¦¬ë‹¤ì´ë ‰ì…˜ ì„¤ì • ì‹¤íŒ¨ë¡œ ì¦‰ì‹œ ì¢…ë£Œ

### 2. ìì‹ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ìˆœì„œ ë¬¸ì œ
- **ê¸°ì¡´ ë¡œì§**: `fork()` â†’ `setup_child_process()` â†’ `execute_command()` â†’ `setup_redirections()`
- **ë¬¸ì œì **: íŒŒì´í”„ ì„¤ì • í›„ ë¦¬ë‹¤ì´ë ‰ì…˜ ì„¤ì •ì´ íŒŒì´í”„ ì„¤ì •ì„ ë®ì–´ì”€

### 3. ë¦¬ë‹¤ì´ë ‰ì…˜ ì„¤ì • ì˜¤ë¥˜
- **ë¬¸ì œ**: `cmd->input_file->filename`ì´ `NULL`ì¸ë°ë„ íŒŒì¼ ì—´ê¸° ì‹œë„
- **ê²°ê³¼**: `open_input_file(NULL)` í˜¸ì¶œë¡œ ìì‹ í”„ë¡œì„¸ìŠ¤ ì‹¤íŒ¨

### 4. íŒŒì´í”„ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ê´€ë¦¬ ë¬¸ì œ
- **ë¬¸ì œ**: NULL ì²´í¬ ì—†ëŠ” FD ì ‘ê·¼, ì¤‘ë³µ ë‹«ê¸°
- **ìœ„í—˜**: ë©”ëª¨ë¦¬ ì ‘ê·¼ ì˜¤ë¥˜ ë° FD ëˆ„ìˆ˜ ê°€ëŠ¥ì„±

## ğŸ”§ ìˆ˜ì • ë‚´ìš©

### 1. `fork_and_execute` í•¨ìˆ˜ ìˆ˜ì • (`src/output/executor/exec_pipe.c`)

#### ğŸ”„ **ìˆ˜ì • ì „:**
```c
if (pid == 0)
{
    // ìì‹ í”„ë¡œì„¸ìŠ¤
    setup_child_process(cmd, pipe_fds, cmd_index, cmd_count);
    exit(execute_command(cmd, shell));  // ë¬¸ì œ: execute_commandì—ì„œ ë¦¬ë‹¤ì´ë ‰ì…˜ ì¬ì„¤ì •
}
```

#### âœ… **ìˆ˜ì • í›„:**
```c
if (pid == 0)
{
    // ìì‹ í”„ë¡œì„¸ìŠ¤: ìˆœì„œ ì¤‘ìš”!
    // 1. íŒŒì´í”„ ì„¤ì • ë° ëª¨ë“  íŒŒì´í”„ FD ë‹«ê¸°
    setup_child_process(cmd, pipe_fds, cmd_index, cmd_count);
    
    // 2. ë¦¬ë‹¤ì´ë ‰ì…˜ ì„¤ì • (íŒŒì´í”„ ì„¤ì • í›„ì—)
    if (setup_redirections(cmd) == FAILURE)
        exit(1);
    
    // 3. ëª…ë ¹ì–´ ìœ íš¨ì„± ê²€ì‚¬
    if (!cmd || !cmd->args || !cmd->args[0])
        exit(1);
    
    // 4. ëª…ë ¹ì–´ ì‹¤í–‰
    if (is_builtin_command(cmd->args[0]))
        exit_code = execute_builtin(cmd, shell);
    else
        exit_code = execute_external(cmd, shell);
    
    exit(exit_code);
}
```

#### ğŸ¯ **í•µì‹¬ ê°œì„ ì :**
1. **ì‹¤í–‰ ìˆœì„œ ë³´ì¥**: íŒŒì´í”„ ì„¤ì • â†’ ë¦¬ë‹¤ì´ë ‰ì…˜ â†’ ëª…ë ¹ì–´ ì‹¤í–‰
2. **ì§ì ‘ ì‹¤í–‰**: `execute_command`ë¥¼ ë¶„í•´í•˜ì—¬ ê° ë‹¨ê³„ë³„ ì œì–´
3. **ì—ëŸ¬ ì²˜ë¦¬**: ê° ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ ì¢…ë£Œ ì½”ë“œ ë°˜í™˜

### 2. `setup_redirections` í•¨ìˆ˜ ìˆ˜ì • (`src/output/executor/redirections.c`)

#### ğŸ”„ **ìˆ˜ì • ì „:**
```c
if (cmd->input_file)
{
    fd_in = open_input_file(cmd->input_file->filename);  // filenameì´ NULLì¼ ìˆ˜ ìˆìŒ
    // ... íŒŒì¼ ì²˜ë¦¬
}
```

#### âœ… **ìˆ˜ì • í›„:**
```c
if (cmd->input_file && cmd->input_file->filename && 
    strcmp(cmd->input_file->filename, "NULL") != 0)
{
    if (cmd->input_file->flag == 1)
        return (print_error("exportê°’", "ambiguous redirect"), FAILURE);
    fd_in = open_input_file(cmd->input_file->filename);
    // ... ì•ˆì „í•œ íŒŒì¼ ì²˜ë¦¬
}
```

#### ğŸ¯ **í•µì‹¬ ê°œì„ ì :**
1. **NULL ì²´í¬**: `filename` í¬ì¸í„°ì™€ ë‚´ìš© ëª¨ë‘ ê²€ì¦
2. **"NULL" ë¬¸ìì—´ ì²´í¬**: íŒŒì‹±ì—ì„œ ì„¤ì •ëœ "NULL" ë¬¸ìì—´ í•„í„°ë§
3. **ì•ˆì „í•œ íŒŒì¼ ì ‘ê·¼**: ìœ íš¨í•œ íŒŒì¼ëª…ë§Œ ì²˜ë¦¬

### 3. íŒŒì´í”„ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ì•ˆì „ì„± ê°•í™”

#### `close_all_pipes` í•¨ìˆ˜ ê°œì„ :
```c
void close_all_pipes(int *pipe_fds, int pipe_count)
{
    int i;

    if (!pipe_fds || pipe_count <= 0)  // NULL ì²´í¬ ì¶”ê°€
        return ;
    i = 0;
    while (i < pipe_count * 2)
    {
        if (pipe_fds[i] >= 0)  // ìœ íš¨í•œ FDë§Œ ë‹«ê¸°
        {
            close(pipe_fds[i]);
            pipe_fds[i] = -1;  // ë‹«ì€ í›„ -1ë¡œ í‘œì‹œí•˜ì—¬ ì¤‘ë³µ ë°©ì§€
        }
        i++;
    }
}
```

#### `setup_parent_process` í•¨ìˆ˜ ê°œì„ :
```c
void setup_parent_process(int *pipe_fds, int cmd_index, int cmd_count)
{
    if (!pipe_fds)  // NULL ì²´í¬ ì¶”ê°€
        return ;
    
    // ì´ì „ íŒŒì´í”„ì˜ ì½ê¸° ë ë‹«ê¸° (ì´ë¯¸ ìì‹ì—ê²Œ ì „ë‹¬ë¨)
    if (cmd_index > 0 && pipe_fds[(cmd_index - 1) * 2 + READ_END] >= 0)
    {
        close(pipe_fds[(cmd_index - 1) * 2 + READ_END]);
        pipe_fds[(cmd_index - 1) * 2 + READ_END] = -1;
    }
    // ... ì¶”ê°€ ì•ˆì „ ì¡°ì¹˜
}
```

### 4. íŒŒì´í”„ ìƒì„± ë¡œì§ ê°œì„ 

#### `create_pipes` í•¨ìˆ˜ ê°•í™”:
```c
static int create_pipes(int **pipe_fds, int cmd_count)
{
    // FD ë°°ì—´ì„ -1ë¡œ ì´ˆê¸°í™” (ì•ˆì „ì„ ìœ„í•´)
    i = 0;
    while (i < (cmd_count - 1) * 2)
    {
        (*pipe_fds)[i] = -1;
        i++;
    }
    
    // íŒŒì´í”„ ìƒì„± ë° ì‹¤íŒ¨ ì‹œ ì •ë¦¬ ë¡œì§ ê°œì„ 
    // ...
}
```

## âœ… ìˆ˜ì • ê²°ê³¼

### í…ŒìŠ¤íŠ¸ ì„±ê³µ ì‚¬ë¡€:

1. **ë¹ŒíŠ¸ì¸ ëª…ë ¹ì–´**:
   ```bash
   minishell$ echo hello world
   hello world
   ```

2. **ì™¸ë¶€ ëª…ë ¹ì–´**:
   ```bash
   minishell$ ls
   Makefile  global.h  libft  main.c  minishell  print  src  types.h
   ```

3. **ì™¸ë¶€ ëª…ë ¹ì–´ íŒŒì´í”„ë¼ì¸**:
   ```bash
   minishell$ ls | grep src
   src
   ```

4. **ë¹ŒíŠ¸ì¸-ì™¸ë¶€ í˜¼í•© íŒŒì´í”„ë¼ì¸**:
   ```bash
   minishell$ echo hello | grep hello
   hello
   ```

### ì„±ëŠ¥ ê°œì„ :
- **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì œê±°**: ì•ˆì „í•œ FD ê´€ë¦¬ë¡œ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ë°©ì§€
- **í”„ë¡œì„¸ìŠ¤ ì•ˆì •ì„±**: ìì‹ í”„ë¡œì„¸ìŠ¤ ì •ìƒ ì¢…ë£Œë¡œ ì¢€ë¹„ í”„ë¡œì„¸ìŠ¤ ë°©ì§€
- **ì‹¤í–‰ ì†ë„**: ë¬´í•œ ë£¨í”„ ì œê±°ë¡œ ì¦‰ì‹œ ì‘ë‹µ

## ğŸ” ì£¼ìš” í•™ìŠµ í¬ì¸íŠ¸

### 1. íŒŒì´í”„ë¼ì¸ì—ì„œ ì‹¤í–‰ ìˆœì„œì˜ ì¤‘ìš”ì„±
- íŒŒì´í”„ ì„¤ì •ê³¼ ë¦¬ë‹¤ì´ë ‰ì…˜ ì„¤ì •ì˜ ìˆœì„œê°€ ë§¤ìš° ì¤‘ìš”
- ì˜ëª»ëœ ìˆœì„œëŠ” íŒŒì´í”„ ì—°ê²°ì„ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŒ

### 2. ìì‹ í”„ë¡œì„¸ìŠ¤ ë””ë²„ê¹…ì˜ ì–´ë ¤ì›€
- ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ ì˜¤ë¥˜ê°€ ë¶€ëª¨ì—ê²Œ ëª…í™•íˆ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
- ì²´ê³„ì ì¸ ë””ë²„ê¹… ì ‘ê·¼ë²• í•„ìš” (`printf` + `fflush` ì¡°í•©)

### 3. íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ê´€ë¦¬ì˜ ë³µì¡ì„±
- NULL ì²´í¬, ì¤‘ë³µ ë‹«ê¸° ë°©ì§€, ìœ íš¨ì„± ê²€ì‚¬ í•„ìˆ˜
- íŒŒì´í”„ì—ì„œëŠ” íŠ¹íˆ ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ ê°„ FD ê³µìœ  ì£¼ì˜

### 4. ë¦¬ë‹¤ì´ë ‰ì…˜ê³¼ íŒŒì´í”„ì˜ ìƒí˜¸ì‘ìš©
- ë‘ ê¸°ëŠ¥ì´ ëª¨ë‘ stdin/stdoutì„ ì¡°ì‘í•˜ë¯€ë¡œ ì¶©ëŒ ê°€ëŠ¥
- íŒŒì´í”„ê°€ ìš°ì„ , ë¦¬ë‹¤ì´ë ‰ì…˜ì€ ì¶”ê°€ ì²˜ë¦¬ë¡œ ì„¤ê³„

## ğŸ“š ê²°ë¡ 

ì´ë²ˆ ìˆ˜ì •ì„ í†µí•´ minishellì˜ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê¸°ëŠ¥ì´ ì™„ì „íˆ ì•ˆì •í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í•µì‹¬ì€ **ì˜¬ë°”ë¥¸ ì‹¤í–‰ ìˆœì„œ ë³´ì¥**ê³¼ **ì•ˆì „í•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬**ì˜€ìœ¼ë©°, ëª¨ë“  ìœ í˜•ì˜ ëª…ë ¹ì–´(ë¹ŒíŠ¸ì¸, ì™¸ë¶€, íŒŒì´í”„ë¼ì¸)ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

*ìˆ˜ì • ì™„ë£Œì¼: 2025ë…„ 9ì›” 10ì¼*  
*ìˆ˜ì •ì: Claude Code Assistant*